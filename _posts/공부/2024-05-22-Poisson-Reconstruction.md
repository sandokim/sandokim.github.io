---
title: "[3D CV] Poisson Surface Reconstruction"
last_modified_at: 2024-05-22
categories:
  - 공부
tags:
  - Poisson Surface Reconstruction
  - Poisson reconstruction
  - Screened Poisson Surface Reconstruction
  - Octree
  - poisson depth
excerpt: "Poisson Reconstruction 정리"
use_math: true
classes: wide
---

## Poisson Reconstruction 빠른 사용 방법

### Poisson detph

Poisson 재구성은 포인트 클라우드(point cloud) 데이터로부터 매끄러운 표면을 생성하는 방법 중 하나입니다. 이 알고리즘은 포인트 클라우드에서 추출한 정상(normal) 벡터를 사용하여 최적의 표면을 계산합니다.

**Poisson Depth = Depth of Octree**

"poisson_depth"는 옥트리의 최대 깊이를 의미합니다. 깊이가 깊을수록 공간을 더 세밀하게 분할하여 작은 세부 사항까지 표현할 수 있습니다.
- 높은 깊이: 더 작은 셀로 공간을 분할하므로, 더 많은 세부 사항을 캡처할 수 있지만, 노이즈와 작은 결함도 더 많이 나타날 수 있습니다.
- 낮은 깊이: 더 큰 셀로 공간을 분할하므로, 큰 구조를 매끄럽게 표현할 수 있지만, 작은 세부 사항은 놓칠 수 있습니다.

### Practical Usage of Poisson depth value
- 깊이 감소: 옥트리 깊이를 줄이면, 표면을 덜 세밀하게 분할하게 되어, 작은 결함이 덜 드러나게 됩니다.
- 메쉬 표면에 지저분한 타원형 돌기가 나타나는 문제를 해결하기 위해 옥트리 깊이를 줄이는 것이 권장됩니다.
```python
poisson_depth = 7
```

## Poisson Reconstruction 원리

### 1 Introduction
This CGAL component implements a surface reconstruction method which takes as input point sets with oriented normals and computes an implicit function. We assume that the input points contain no outliers and little noise. The output surface mesh is generated by extracting an isosurface of this function with the CGAL Surface Mesh Generator [4] or potentially with any other surface contouring algorithm.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/d4f91c48-5648-4ff2-b948-cc22b39473b6)

Figure 63.1 Poisson surface reconstruction.
Left: 17K points sampled on the statue of an elephant with a Minolta laser scanner. Right: reconstructed surface mesh.

More specifically, the core surface reconstruction algorithm consists of computing an implicit function which is an approximate indicator function of the inferred solid (Poisson Surface Reconstruction - referred to as Poisson). Poisson is a two steps process: it requires solving for the implicit function before function evaluation.

### Common Reconstruction Pipeline
Surface reconstruction from point sets is often a sequential process with the following steps: 1) Scanning and scan alignment produce a set of points or points with normals; 2) Outlier removal; 3) Simplification to reduce the number of input points; 4) Smoothing to reduce noise in the input data; 5) Normal estimation and orientation when the normals are not already provided by the acquisition device; and 6) Surface reconstruction.

CGAL provides algorithms for all steps listed above except alignment.

Chapter Point Set Processing describes algorithms to pre-process the point set before reconstruction with functions devoted to the simplification, outlier removal, smoothing, normal estimation and normal orientation.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/0534262e-e045-4132-8d90-91f8c95816a6)

Figure 63.2 Common surface reconstruction pipeline.

### 3 Poisson
Given a set of 3D points with oriented normals (denoted oriented points in the sequel) sampled on the boundary of a 3D solid, the Poisson Surface Reconstruction method [2] solves for an approximate indicator function of the inferred solid, whose gradient best matches the input normals. The output scalar function, represented in an adaptive octree, is then iso-contoured using an adaptive marching cubes.

CGAL implements a variant of this algorithm which solves for a piecewise linear function on a 3D Delaunay triangulation instead of an adaptive octree. The algorithm takes as input a set of 3D oriented points. It builds a 3D Delaunay triangulation from these points and refines it by Delaunay refinement so as to remove all badly shaped (non-isotropic) tetrahedra and to tessellate a loose bounding box of the input oriented points. The normal of each Steiner point added during refinement is set to zero. It then solves for a scalar indicator function $f$ represented as a piecewise linear function over the refined triangulation. More specifically, it solves for the Poisson equation

$$ \Delta f = \text{div}(n) $$

at each vertex of the triangulation using a sparse linear solver. Eventually, the CGAL surface mesh generator extracts an isosurface with function value set by default to be the median value of $f$ at all input points.

### 4 Reconstruction Function
A global function poisson_surface_reconstruction_delaunay() is provided. It takes points with normals as input and handles the whole reconstruction pipeline :

- it computes the implicit function
- it reconstructs the surface with a given precision using the CGAL surface mesh generator based on Delaunay refinement [4] [1]
- it outputs the result in a polygon mesh.
  
This function aims at providing a quick and user-friendly API for Poisson reconstruction. Advanced users may be interested in using the class (see Reconstruction Class) which allows them, for example, to use another surface mesher or a different output structure.

...

### 6 Case Studies
The surface reconstruction problem being inherently ill-posed, the proposed algorithm does not pretend to reconstruct all kinds of surfaces with arbitrary sampling conditions. This section provides the user with some hints about the ideal sampling and contouring conditions, and depicts some failure cases when these conditions are not matched.

#### 6.1 Ideal Conditions
**The user must keep in mind that the Poisson surface reconstruction algorithm comprises two phases (computing the implicit function from the input point set and contouring an iso-surface of this function). Both require some care in terms of sampling conditions and parameter tuning.**

#### 6.2 Point Set
Ideally the current implementation of the Poisson surface reconstruction method expects a dense 3D oriented point set (typically matching the epsilon-sampling condition [1]) and sampled over a closed, smooth surface. Oriented herein means that all 3D points must come with consistently oriented normals to the inferred surface. Figure 63.3 and Figure 63.4 illustrate cases where these ideal conditions are met.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/b9e714e3-d400-4ade-9117-44559c40d40f)

Figure 63.3 Poisson reconstruction. Left: 120K points sampled on a statue (Minolta laser scanner). Right: reconstructed surface mesh.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/36fa135e-3620-4e40-86c6-6e48eb520fc1)

Figure 63.4 Left: 120K points sampled on a statue (Minolta laser scanner). Right: reconstructed surface mesh.

The algorithm is fairly robust to anisotropic sampling and to noise. It is also robust to missing data through filling the corresponding holes as the algorithm is designed to reconstruct the indicator function of an inferred solid (see Figure 63.5).

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/737df213-db98-40fc-b81f-5eccc5bc1086)

Figure 63.5 Top left: 65K points sampled on a hand (Kreon laser scanner). Bottom left: the point set is highly anisotropic due to the scanning technology. Right: reconstructed surface mesh and closeup. The holes are properly closed.

The algorithm is in general not robust to outliers, although a few outliers do not always create a failure, see Figure 63.6.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/f842579d-5104-4762-b845-70ebbda7a3e8)

Figure 63.6 Left: 70K points sampled on an elephant with few outliers emphasized with disks. Right: reconstructed surface mesh.

The algorithm works well even when the inferred surface is composed of several connected components, provided that both all normals are properly estimated and oriented (the current CGAL normal orienter algorithm may fail in some cases, see mst_orient_normals()), and that the final contouring algorithm is properly seeded for each component. When the inferred surface is composed of several nested connected components care should be taken to orient the normals of each component in alternation (inward/outward) so that the final contouring stage picks a proper contouring value.

#### 6.3 Contouring Parameters
Our implementation of the Poisson surface reconstruction algorithm computes an implicit function represented as a piecewise linear function over the tetrahedra of a 3D Delaunay triangulation constructed from the input points then refined through Delaunay refinement. For this reason, any iso-surface is also piecewise linear and hence may contain sharp creases. As the contouring algorithm make_surface_mesh() expects a smooth implicit function these sharp creases may create spurious clusters of vertices in the final reconstructed surface mesh when setting a small mesh sizing or surface approximation error parameter (see Figure 63.7).

One way to avoid these spurious clusters consists of adjusting the mesh sizing and surface approximation parameters large enough compared to the average sampling density (obtained through compute_average_spacing()) so that the contouring algorithm perceives a smooth iso-surface. We recommend to use the following contouring parameters:

- Max triangle radius: at least 100 times the average spacing.
- Approximation distance: at least 0.25 times the average spacing.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/0a856723-1c2c-4154-bede-91e90aaed839)

Figure 63.7 Left: surface reconstructed with approximation distance = 0.25 * average spacing. Right: surface reconstructed with approximation distance = 0.15 * average spacing. Notice the spurious cluster on the cheek.

#### 6.4 Degraded Conditions
The conditions listed above are rather restrictive and in practice not all of them are met in the applications. We now illustrates the behavior of the algorithm when the conditions are not met in terms of sampling, wrongly oriented normals, noise and sharp creases.

#### 6.5 Sparse Sampling
The reconstruction algorithm expects a sufficiently dense point set. Although there is no formal proof of correctness of the algorithm under certain density conditions due to its variational nature, our experiments show that the algorithm reconstructs well all thin features when the local spacing is at most one tenth of the local feature size (the distance to the medial axis, which captures altogether curvature, thickness and separation). When this condition is not met the reconstruction does not reconstruct the thin undersampled features (see Figure 63.8).

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/9bc95c19-a9cc-45ba-9f52-cc37a911b4bc)

Figure 63.8 Left: 50K points sampled on the Neptune trident. The reconstruction (not shown) is successful in this case. Right: point set simplified to 1K points then reconstructed (all input points are depicted with normals). The thin feature is not reconstructed.

#### 6.6 Large Holes
The reconstruction is devised to solve for an implicit function which is an approximate indicator function of an inferred solid. For this reason the contouring algorithm always extracts a closed surface mesh and hence is able to fill the small holes where data are missing due, e.g., to occlusions during acquisition (see Figure 63.9).

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/350dc178-bc95-4d02-bcc9-d86fdc433007)

Figure 63.9 Left: 65K points sampled on a hand with no data captured at the wrist base. Right: reconstructed surface mesh. The surface is properly closed on the fingers and also closed at the wrist but in a less plausible manner.

In case of large holes the algorithm still closes them all but the resulting piecewise linear implicit function may exhibit large triangle patches and sharp creases as the 3D Delaunay triangulation used for solving is very coarse where the holes are filled. This can be avoided by a two pass approach. The first pass for a subset of the points serves to get an approximation of the surface at the holes. This surface then serves to compute a smoother 3D Delaunay triangulation for the second pass with the full set of points.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/46361dd9-0b17-4afb-871b-85f7a1bc2135)

Figure 63.10 Left: The wrist. Middle: one pass. Right: two passes.

#### 6.7 Wrongly Oriented Normals
The Poisson surface reconstruction approaches solves for an implicit function whose gradient best matches a set of input normals. Because it solves this problem in the least squares sense, it is robust to few isolated wrongly oriented (flipped) normals. Nevertheless a cluster of wrongly oriented normals leads to an incorrect implicit function and hence to spurious geometric or even topological distortion (see Figure 63.11).

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/b0308cc6-d191-4ced-8bbd-915dbeec4502)

Figure 63.11 Left: points sampled on a sphere with a cluster of wrongly oriented normals. Right: reconstructed surface mesh with a spurious bump.

#### 6.8 Noise and Outliers
A large amount of noise inevitably impacts on the reconstruction (see Figure 63.12, top) and the current implementation does not provide any mean to trade data fitting for smoothness. Nevertheless if the signal-to-noise ratio is sufficiently high and/or the surface approximation and sizing parameters set for contouring the iso-surface is large with respect to the noise level the output surface mesh will appear smooth (not shown). If the user wants to produce a smooth and detailed output surface mesh, we recommend to apply smoothing through jet_smooth_point_set() (see Figure 63.12, bottom).

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/a741aa30-63eb-44f4-9b61-0b4af877b6c8)

Figure 63.12 Top-left: points sampled on a sphere and corrupted with a lot of noise. Top-right: reconstructed surface mesh. Bottom-left: smoothed point set. Bottom-right: reconstructed surface mesh.

#### 6.9 Sharp Creases
The current reconstruction algorithm is not able to recover the sharp creases and corners present in the inferred surface. This translates into smoothed sharp creases.

![image](https://github.com/sandokim/sandokim.github.io/assets/74639652/3f22a2b3-d0df-4ec2-b07e-3ea4038f1479)

Figure 63.13 Left: 5K points sampled on a mechanical piece with sharp features (creases, darts and corners). Right: reconstructed surface mesh with smoothed creases.



### Reference
- [Poisson Surface Reconstruction User Guide](https://doc.cgal.org/latest/Poisson_surface_reconstruction_3/index.html)
- [Poisson Surface Reconstruction](https://hhoppe.com/poissonrecon.pdf)
- [Screened Poisson Surface Reconstruction](https://www.cs.jhu.edu/~misha/MyPapers/ToG13.pdf)
